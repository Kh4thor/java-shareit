Ирек, приветствую!
Надеюсь, я правильно понял замечания.
Не самое простое задание в плане требований фз.